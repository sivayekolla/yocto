ALL STEPS AND TECHNIQUES COMPILED
PART 1: INTRODUCTION TO YOCTO PROJECT
1.1 What is Yocto Project
The Yocto Project is an open source collaboration project that provides templates tools and methods to create custom Linux based systems for embedded products regardless of the hardware architecture

It is not a Linux distribution but a build system or framework for creating custom embedded Linux distributions

It is supported by the Linux Foundation and allows for collaboration through shared technologies software stacks and best practices

The project is architecture agnostic supporting ARM x86 x86 64 PowerPC MIPS and RISC V

It follows a strict six month release schedule with releases named after chemicals elements or acronyms

1.2 Why Use Yocto Project
Complete control over the Linux system being built including kernel version libraries and applications

Reproducible builds ensuring that the same input produces the same output every time

Highly customizable allowing inclusion of only necessary components reducing image size and attack surface

Supports multiple hardware platforms from a single code base

Large community and extensive documentation

Used by major companies and silicon vendors providing board support packages

1.3 Core Components Terminology
Poky is the reference distribution or starter kit of the Yocto Project

Poky contains BitBake OpenEmbedded Core and a set of default metadata layers

BitBake is the task executor and scheduler similar to make but more powerful

BitBake reads and interprets all metadata recipes and configuration files to determine what needs to be built and in what order

BitBake then executes the tasks to build the components

Metadata is the collective term for recipes classes and configuration files

Metadata tells BitBake how to fetch source code apply patches compile and package software

OpenEmbedded Core is a core set of metadata layers containing base recipes classes and configurations

Recipes are the most common form of metadata files ending with .bb extension

Recipes contain instructions for building a specific piece of software

Append files end with .bbappend extension and are used to extend or modify existing recipes without changing the original recipe

Configuration files end with .conf extension and set global or layer specific variables

Classes end with .bbclass extension and provide common functionality that can be inherited by multiple recipes

Layers are collections of related metadata repositories with names typically starting with meta

PART 2: THE LAYER MODEL
2.1 Understanding Layers
Layers allow logical separation of metadata based on functionality hardware or software stacks

Each layer contains its own recipes configuration files and classes

The layer model provides modularity grouping functionality into separate bundles

Only necessary layers are included in a specific project

Layers can be shared and reused across multiple projects

BSP layers from silicon vendors provide hardware specific support

Software layers provide additional functionality like Qt or Python

2.2 Layer Structure and Conventions
Layer names conventionally begin with meta prefix

Each layer must contain a layer.conf file

The layer.conf file tells BitBake about the layer and its contents

Layers should be independent allowing them to be combined in various ways

Layers can depend on other layers creating a hierarchy

The Yocto Project provides standard layers like meta meta poky meta yocto bsp

Third party layers are available from hardware vendors and the community

2.3 Layer Priorities
Each layer has a priority number higher number means higher priority

When multiple layers provide the same recipe the one with highest priority is used

This allows overriding recipes from lower priority layers

Priority is set in the layer.conf file

Proper priority management is essential for predictable builds

PART 3: SETTING UP THE BUILD ENVIRONMENT
3.1 Host System Requirements
Operating System must be a Linux distribution

Ubuntu 20 04 or later is recommended and well supported

Other distributions like Fedora CentOS Debian also work with appropriate package installations

Windows Subsystem for Linux version 2 allows running Yocto on Windows

Storage space minimum 50 gigabytes free

Strongly recommended storage space 250 gigabytes or more

Build process generates many large files including source archives build artifacts and final images

RAM minimum 8 gigabytes

Strongly recommended RAM 16 gigabytes or more

CPU multi core processor recommended

More cores significantly reduce build times

Reliable internet connection required to fetch source code from upstream repositories

3.2 Required Host Packages
Essential packages must be installed before building

For Ubuntu and Debian based systems required packages include

gawk wget git diffstat unzip texinfo gcc build essential chrpath socat cpio python3 python3 pip python3 jinja2 xz utils debianutils iputils ping python3 git libssl dev

Additional packages for graphical support include

libegl1 mesa libsdl1 2 dev

For Fedora CentOS and RHEL based systems different package names are used

The Yocto Project manual provides complete lists for all distributions

3.3 Obtaining Poky
Poky is obtained using git version control system

The repository is cloned from the official Yocto Project git server

A specific release branch is checked out to ensure stability

Common release branches include kirkstone langdale mickledore nanbield scarthgap

The clone command creates a poky directory containing all metadata

The poky directory includes BitBake OpenEmbedded Core and documentation

3.4 Initializing the Build Environment
A dedicated build directory is created for each project

The build directory contains all configuration files and build output

Separating build output from source code is standard practice

The oe init build env script is sourced to initialize the environment

This script is located in the poky directory

The script requires the path to the build directory as an argument

If the build directory does not exist the script creates it

After sourcing the script the shell environment is modified

All necessary BitBake commands become available in the shell

The current working directory changes to the build directory

Default configuration files are created in the build directory conf folder

These default files are local conf and bblayers conf

PART 4: CONFIGURING THE BUILD
4.1 The Build Directory Structure
The build directory contains several important subdirectories

The conf directory contains all build configuration files

The downloads directory stores downloaded source code archives

The sstate cache directory stores shared state artifacts

The tmp directory contains all build output

The cache directory stores internal BitBake cache data

4.2 The local conf File
The local conf file is the primary configuration file for local user settings

This file is located in the build directory conf folder

The MACHINE variable is the most important setting

MACHINE specifies the target hardware for the build

Examples of machine names include qemux86 64 raspberrypi4 64 beaglebone yocto

The MACHINE variable determines which board support package is used

The DL DIR variable specifies the download directory

Sharing DL DIR between projects prevents re downloading the same source code

The SSTATE DIR variable specifies the shared state cache directory

The shared state cache allows reusing build artifacts from previous builds

This significantly reduces build times for subsequent builds

The TMPDIR variable specifies the temporary build directory

TMPDIR contains all compiled objects and final images

This directory becomes very large during builds

The PACKAGE CLASSES variable sets the package format

Common formats include package rpm package deb and package ipk

RPM is the default format in Poky

IPK is commonly used in embedded systems

DEB is used in Debian based distributions

The EXTRA IMAGE FEATURES variable adds features to the target image

Features include ssh server openssh debug tweaks tools sdk and package management

The debug tweaks feature allows root login without password

The CORE IMAGE EXTRA INSTALL variable adds packages to images

Packages listed here are installed without modifying recipes

This is convenient for adding custom applications to standard images

The USER CLASSES variable adds additional functionality to the build

Common user classes include buildstats image types and populate sdk

The PATCHRESOLVE variable controls patch conflict resolution behavior

4.3 The bblayers conf File
The bblayers conf file tells BitBake which layers to use

This file is located in the build directory conf folder

The BBLAYERS variable contains paths to layer directories

Each layer path must be absolute or relative to the build directory

New layers must be added to this file

The bitbake layers add layer command automatically adds layers

Layers can be removed using bitbake layers remove layer

The order of layers in BBLAYERS affects priority

The BBLAYERS variable is a space separated list of paths

4.4 The site conf File
The site conf file contains site specific information

This file is optional and not created by default

Site conf can override settings from other configuration files

It is typically used in shared build environments

4.5 Layer Configuration Files
Each layer contains its own configuration files

Layer conf files are located in the layer's conf directory

The layer conf file defines the layer name and priority

Layer priorities are set in the layer conf file

Higher priority layers override lower priority layers

Layer conf files can also set layer specific variables

PART 5: THE BUILD PROCESS
5.1 Build Phases Overview
The build process consists of multiple phases executed in sequence

Fetching downloads source code from specified locations

Unpacking extracts downloaded source archives

Patching applies patches to the source code

Configuration configures the source for compilation

Compilation compiles the source code into binaries

Installation installs binaries into a temporary directory

Packaging creates binary packages from installed files

Image creation assembles packages into a root filesystem image

5.2 BitBake Operation
BitBake parses all metadata from configured layers

Parsing includes recipes classes and configuration files

BitBake builds a dependency tree of all tasks

The dependency tree determines execution order

BitBake calculates task checksums to determine rebuild requirements

If inputs to a task have not changed the task can be skipped

This is the basis of the shared state cache mechanism

BitBake schedules tasks for parallel execution when possible

The number of parallel tasks is controlled by configuration

5.3 The Work Directory Structure
The tmp directory contains detailed build output

The work subdirectory contains per recipe build directories

Each recipe has a directory named after the recipe and target architecture

Example path tmp work cortexa57 poky linux helloworld 1 0

The recipe work directory contains multiple subdirectories

The git or source directory contains unpacked source code

The build directory contains compilation artifacts

The image directory contains files installed by the recipe

The sysroot destdir contains files staged for the sysroot

The temp directory contains logs and run files

The temp log task order file shows task execution order

The temp log do compile file shows compilation output

The temp run do compile script is the actual task execution script

5.4 The Deploy Directory
The deploy directory contains final build output

The images subdirectory contains bootable images

Image files include root filesystems kernels and device trees

Common image formats include ext4 squashfs jffs2 and cpio

The deploy images machine directory contains machine specific images

The deploy rpm directory contains RPM packages

The deploy deb directory contains DEB packages if enabled

The deploy ipk directory contains IPK packages if enabled

5.5 The Sysroots Directory
The sysroots directory contains sysroots for target and host

The target sysroot contains libraries and headers for the target

The host sysroot contains tools for the build host

Sysroots are used for cross compilation

Recipes stage their output into the appropriate sysroots

5.6 The Downloads Directory
The downloads directory stores source code archives

Each downloaded file is stored here

Files are named after their checksums

Sharing downloads between projects saves bandwidth and time

The downloads directory can be safely shared across multiple builds

5.7 The Sstate Cache Directory
The sstate cache stores task output for reuse

Each cached task is identified by its task checksum

If a task is unchanged the output is restored from cache

This significantly speeds up subsequent builds

The sstate cache can be shared between developers

PART 6: WORKING WITH RECIPES
6.1 Recipe Fundamentals
Recipes are files with .bb extension

Each recipe describes how to build a piece of software

Recipes contain variables and tasks

The SUMMARY variable provides a brief description

The DESCRIPTION variable provides detailed description

The HOMEPAGE variable points to the software homepage

The LICENSE variable specifies the software license

The LIC FILES CHKSUM variable verifies license files

The SRC URI variable specifies source code location

Source locations can be http https git ftp or file

The SRCREV variable specifies git revision for git sources

The PV variable specifies package version

The PR variable specifies package revision

The SECTION variable categorizes the package

The DEPENDS variable lists build time dependencies

The RDEPENDS variable lists runtime dependencies

6.2 Recipe Tasks
Tasks are units of work in a recipe

Common tasks include do fetch do unpack do patch

do configure do compile do install do package

do populate sysroot do package write rpm

do rootfs do image

Each task can be extended or overridden

Tasks can have dependencies on other tasks

Tasks can be executed individually using bitbake

6.3 Append Files
Append files have .bbappend extension

Append files modify existing recipes without changing them

The append file name must match the recipe name

Append files can add or override variables

Append files can add or modify tasks

Append files are located in layers with higher priority

Multiple append files can affect the same recipe

6.4 Recipe Inheritance
Recipes can inherit classes using the inherit keyword

Classes provide common functionality

The autotools class handles autotools based builds

The cmake class handles CMake based builds

The qmake class handles Qt qmake based builds

The python setuptools class handles Python packages

Inheriting a class adds its tasks and variables to the recipe

6.5 Common Recipe Variables
The S variable points to the source code directory

The B variable points to the build directory

The D variable points to the destination directory for installation

The WORKDIR variable points to the recipe work directory

The PN variable contains the package name

The PV variable contains the package version

The PR variable contains the package revision

The P variable contains PN PV combined

The PF variable contains PN PV PR combined

The FILE variable contains the full path to the recipe

PART 7: IMAGE CREATION
7.1 Image Recipes
Image recipes create complete root filesystem images

Image recipes inherit the core image class

Image recipes list packages to include

The IMAGE INSTALL variable lists packages to install

The IMAGE FEATURES variable adds features to the image

Standard image recipes include core image minimal

core image base core image full cmdline

core image sato core image sato dev

core image Weston

7.2 Custom Image Creation
Custom image recipes can be created

A new .bb file is created in a layer

The recipe inherits core image

IMAGE INSTALL is populated with desired packages

The recipe can include custom configuration files

Post processing scripts can be added

7.3 Package Groups
Package groups are collections of related packages

Package group recipes end with packagegroup bb

Package groups are used in image recipes

They simplify adding multiple related packages

Common package groups exist for development tools

Debugging tools networking packages

7.4 Image Types
The IMAGE FSTYPES variable controls output formats

Common types include ext4 ext3 ext2 squashfs

jffs2 cpio tar ubifs

Multiple types can be specified simultaneously

Each type produces a different image file

PART 8: KERNEL AND BSP
8.1 Kernel Recipes
Kernel recipes build the Linux kernel

The linux yocto recipe is the reference kernel

Kernel recipes inherit the kernel class

The kernel class provides kernel specific functionality

The SRC URI points to kernel source

The KBRANCH variable specifies kernel branch

The KERNEL VERSION variable sets kernel version

The KERNEL FEATURES variable enables kernel features

8.2 Kernel Configuration
Kernel configuration is managed through fragments

Configuration fragments are .cfg files

Fragments can enable disable kernel options

Multiple fragments can be combined

The KBUILD DEFCONFIG variable sets default config

Defconfig files provide complete configurations

8.3 Device Trees
Device trees describe hardware to the kernel

Device tree source files have .dts extension

Device tree compiler produces .dtb files

The KERNEL DEVICETREE variable lists device trees to build

Device trees are deployed to the images directory

8.4 Board Support Package Layers
BSP layers provide hardware specific support

BSP layers contain machine configurations

Kernel recipes and configurations

Bootloader recipes and configurations

Hardware specific libraries and tools

BSP layers are provided by hardware vendors

PART 9: PACKAGE MANAGEMENT
9.1 Package Formats
Three package formats are supported

RPM is the default in Poky

IPK is popular in embedded systems

DEB is used in Debian based systems

The PACKAGE CLASSES variable selects the format

Multiple formats can be enabled simultaneously

9.2 Package Feeds
Package feeds enable runtime package management

Feeds are directories containing packages

The build system creates feed directories

Feeds can be served via http or ftp

Target devices can install packages from feeds

The package management feature must be enabled

9.3 Smart Package Manager
Smart is the package manager for RPM

Smart can install remove and update packages

Smart uses feed configurations

Smart is included in images with package management enabled

9.4 Opkg Package Manager
Opkg is the package manager for IPK

Opkg is lightweight and designed for embedded systems

Opkg uses feed configurations

Opkg is included in images with package management enabled

PART 10: SDK AND APPLICATION DEVELOPMENT
10.1 Standard SDK
The standard SDK contains cross development tools

Libraries and headers for the target

The SDK is generated using populate sdk

The populate sdk task creates an installer script

The installer script installs the SDK on a development machine

The SDK enables application development without full build system

10.2 Extensible SDK
The extensible SDK includes additional features

Recipe building capabilities within the SDK

Devtool integration for application development

Easier updates and customization

Larger size than standard SDK

10.3 Devtool
Devtool simplifies application development workflow

Devtool create creates new recipes

Devtool modify sets up workspace to modify source

Devtool build builds software in workspace

Devtool deploy deploys to target

Devtool finish integrates changes back into layer

Devtool is part of the extensible SDK

10.4 Application Development Workflow
Application development follows specific workflow

Recipe is created for the application

Application is built using bitbake

Application is included in image

Image is tested on target or QEMU

Application can be modified and rebuilt

Devtool streamlines this process

PART 11: DEBUGGING AND TROUBLESHOOTING
11.1 BitBake Logs
BitBake generates detailed logs for each task

Logs are stored in recipe temp directories

The do compile log shows compilation output

The do configure log shows configuration output

The log.do task files contain task specific output

The run.do task files contain the actual task commands

11.2 BitBake Command Options
BitBake provides debugging options

bitbake e shows recipe environment variables

bitbake g shows dependency graph

bitbake s shows recipe versions

bitbake S shows task signatures

bitbake c task runs specific task

11.3 Common Issues and Solutions
Fetch failures require checking network and SRC URI

Compilation failures require checking logs for errors

Missing dependencies require adding to DEPENDS

Runtime failures require checking RDEPENDS

Image creation failures require checking disk space

Configuration errors require checking local conf

11.4 Shared State Cache Issues
Sstate cache can cause unexpected behavior

Cache may contain outdated artifacts

Cleaning sstate cache forces rebuild

bitbake C task cleans specific task

Removing tmp directory forces full rebuild

PART 12: ADVANCED TECHNIQUES
12.1 Custom Layers Creation
Custom layers are created for project specific metadata

The bitbake layers create layer command creates layer skeleton

The new layer requires conf layer conf file

The layer must be added to bblayers conf

Recipes are added to layer recipes example directories

Append files are added to layer recipes example directories

12.2 Overriding Recipes
Recipes can be overridden using higher priority layers

Complete recipes can be replaced

Append files can modify existing recipes

Variable overrides apply based on machine or class

The overrides mechanism provides flexibility

12.3 Patching Source Code
Patches are stored in recipe file directories

Patches are listed in SRC URI

Patches are applied in order during do patch

Quilt manages patch application

Patches can be created using quilt or git

12.4 Adding New Machine Support
New machines require machine configuration files

Machine conf files are stored in conf machine

The machine file defines hardware characteristics

Required variables include TARGET ARCH

TARGET CPU TARGET OS

MACHINE FEATURES and IMAGE FSTYPES

The machine file may include kernel and bootloader settings

12.5 Build Performance Optimization
Parallelism settings affect build speed

BB NUMBER THREADS controls BitBake threads

PARALLEL MAKE controls make jobs

Sstate cache significantly improves performance

Download directory sharing reduces network usage

Temporary directory on fast storage helps

12.6 Toaster Web Interface
Toaster provides web based build interface

Build history and statistics

Recipe and package browsing

Build configuration management

Toaster can be run in analysis or managed mode

PART 13: WORKFLOW SUMMARY
13.1 Complete Project Workflow
Host system preparation with required packages

Poky clone from git repository

Build directory creation and environment initialization

Local conf configuration for target machine

Layer addition for required functionality

Custom recipe creation for project software

Image recipe creation or modification

Build execution using bitbake

Image testing in QEMU

Image deployment to target hardware

Application development using SDK or devtool

13.2 Development Cycle
Modify source code or configuration

Incremental build using sstate cache

Test on target or QEMU

Repeat until functionality is achieved

Integrate changes back into layers

Document modifications for future reference

13.3 Best Practices
Keep layers modular and focused

Use append files instead of modifying recipes

Share downloads and sstate cache between projects

Version control all metadata

Tag releases for reproducibility

Document configuration choices

Follow Yocto Project conventions and style

PART 14: IMPORTANT VARIABLES REFERENCE
14.1 Build Configuration Variables
MACHINE target hardware

DL DIR download directory

SSTATE DIR shared state cache directory

TMPDIR temporary build directory

PACKAGE CLASSES package format

EXTRA IMAGE FEATURES additional image features

CORE IMAGE EXTRA INSTALL additional packages

IMAGE FSTYPES image output formats

BB NUMBER THREADS BitBake threads

PARALLEL MAKE make jobs

14.2 Recipe Variables
SUMMARY brief description

DESCRIPTION detailed description

HOMEPAGE software homepage

LICENSE software license

LIC FILES CHKSUM license file checksums

SRC URI source location

SRCREV git revision

PV package version

PR package revision

DEPENDS build dependencies

RDEPENDS runtime dependencies

S source directory

B build directory

D destination directory

WORKDIR recipe work directory

PN package name

14.3 Machine Variables
TARGET ARCH target architecture

TARGET OS target operating system

TARGET CPU target CPU

TARGET FPU target floating point unit

MACHINE FEATURES hardware features

KERNEL IMAGETYPE kernel image format

SERIAL CONSOLE serial console device

IMAGE FSTYPES image formats for machine

PART 15: FINAL NOTES
15.1 Documentation Resources
Yocto Project Mega Manual is complete reference

Yocto Project Application Development Guide

Yocto Project Kernel Development Manual

Yocto Project Board Support Package Guide

Yocto Project Development Tasks Manual

Yocto Project Reference Manual

BitBake User Manual

15.2 Community Resources
Yocto Project mailing lists

Yocto Project IRC channel

Yocto Project bug tracking system

Yocto Project wiki

Yocto Project monthly status reports

15.3 Key Takeaways
Yocto Project enables complete control over embedded Linux

Understanding layers is fundamental to organization

Proper configuration is essential for successful builds

Sstate cache dramatically improves build times

Recipes describe how to build software

Append files enable modification without duplication

Images are the final output containing root filesystems

SDK enables application development without full build system

Debugging requires understanding logs and build structure

Best practices ensure maintainable and reproducible builds


